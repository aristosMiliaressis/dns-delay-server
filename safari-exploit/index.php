<?php
// https://stackoverflow.com/questions/4356289/php-random-string-generator
function generateRandomString($length = 10) {
    $characters = '0123456789abcdefghijklmnopqrstuvwxyz';
    $charactersLength = strlen($characters);
    $randomString = '';
    for ($i = 0; $i < $length; $i++) {
        $randomString .= $characters[random_int(0, $charactersLength - 1)];
    }
    return $randomString;
}

// Redirect to a random rebinding domain if not requested that way in use. This allows bypassing DNS caches by using a new domain each time
$rebindZone = 'r.intrud.es';
$hostPort = $_SERVER['HTTP_HOST']; // e.g. example.com:8080
if (strpos($hostPort, $rebindZone) === false) {
    $newDomain = generateRandomString(12) . '.' . $rebindZone;
    $newLocation = 'http://' . $newDomain . ':' . $_SERVER['SERVER_PORT'];
    header('Location: ' . $newLocation);
    die();
}
?>

<html>
    <body>
        <p>Hello world!</p>
        <!-- Token: MyServerToken -->
        <script type="text/javascript">
            <?php
            // Include the file directly to save another request
            echo file_get_contents("./script.js") 
            ?>
        </script>
    </body>
</html>
